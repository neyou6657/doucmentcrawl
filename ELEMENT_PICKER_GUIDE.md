# 🎯 元素选择器使用指南

## 概述

新增的元素选择器功能让你可以像使用浏览器开发者工具一样，直接用鼠标点击来选择页面元素，无需手动编写 CSS 选择器！

## 特性

- ✅ **可视化选择** - 鼠标悬停时实时高亮元素
- ✅ **智能识别** - 自动生成最优的 CSS 选择器
- ✅ **即时反馈** - 显示将会匹配的链接/内容数量
- ✅ **简单易用** - 无需了解 CSS 选择器语法
- ✅ **快捷操作** - 按 ESC 键随时取消

## 使用步骤

### 第一步：选择链接区域

1. 打开控制面板
2. 点击 **🎯 选择链接区域** 按钮
3. 页面会出现半透明遮罩层
4. 移动鼠标，被高亮的元素会显示橙色边框
5. 点击包含导航链接的区域（例如侧边栏、导航栏）
6. 看到确认提示，显示找到的链接数量

### 第二步：选择内容区域

1. 点击 **🎯 选择内容区域** 按钮
2. 移动鼠标到主内容区域
3. 点击包含文档内容的区域（例如文章、主内容区）
4. 看到确认提示

### 第三步：开始抓取

1. 点击 **1. 扫描链接** 按钮
2. 查看扫描结果
3. 点击 **2. 开始抓取** 按钮
4. 等待抓取完成
5. 导出数据

## 视觉反馈

### 选择模式下会看到：

- **橙色高亮边框** - 当前鼠标悬停的元素
- **黑色提示框** - 显示元素信息和生成的选择器
- **屏幕中央提示** - 说明当前正在选择什么（3秒后消失）
- **十字光标** - 表示处于选择模式

### 提示框内容：

```
<div class="sidebar">
选择器: .sidebar
```

## 选择器生成规则

工具会自动选择最优的选择器，优先级如下：

1. **ID 选择器** - 如果元素有唯一 ID
   - 例如：`#sidebar`

2. **类选择器** - 如果类名唯一
   - 例如：`.sidebar`

3. **标签+类选择器** - 结合标签名和类名
   - 例如：`nav.main-nav`

4. **属性选择器** - 使用 role、data-* 等属性
   - 例如：`[role="navigation"]`

5. **路径选择器** - 作为后备方案
   - 例如：`body > div:nth-child(2) > nav`

### 链接区域特殊处理

选择链接区域时，工具会自动在选择器后添加 ` a`，例如：
- 你选择了 `.sidebar`
- 实际使用的选择器是 `.sidebar a`
- 这样可以直接匹配该区域内的所有链接

## 使用技巧

### ✅ 推荐做法

1. **选择容器元素**
   - 选择包含多个链接的容器，而不是单个链接
   - 例如：整个侧边栏，而不是某一个链接

2. **选择稳定的元素**
   - 优先选择有明确语义的元素（nav、aside、main、article）
   - 避免选择动态生成或频繁变化的元素

3. **验证结果**
   - 查看提示框显示的链接数量
   - 如果数量不对，可以按 ESC 取消并重新选择

4. **逐步细化**
   - 如果选择的区域太大，可以选择更具体的子元素
   - 如果选择的区域太小，可以选择父元素

### ❌ 避免的做法

1. **不要选择太小的元素**
   - 不要选择单个链接或文本节点
   - 应该选择包含多个链接的容器

2. **不要选择动态元素**
   - 避免选择有 `hover`、`active` 等状态的元素
   - 避免选择广告、弹窗等动态内容

3. **不要选择控制面板**
   - 工具会自动忽略控制面板本身
   - 如果误选，按 ESC 取消

## 示例场景

### 场景 1：文档网站（如本项目的 README）

**页面结构：**
```
├── 侧边栏 (.sidebar)
│   ├── 快速开始
│   ├── 安装指南
│   └── API 文档
└── 主内容 (.main-content)
    ├── 标题
    ├── 段落
    └── 代码示例
```

**操作：**
1. 点击"选择链接区域"
2. 点击左侧侧边栏 → 生成 `.sidebar a`
3. 点击"选择内容区域"
4. 点击右侧主内容 → 生成 `.main-content`

### 场景 2：GitHub Wiki

**操作：**
1. 选择右侧目录区域 → 生成 `.wiki-rightbar a`
2. 选择文章内容区域 → 生成 `#wiki-body`

### 场景 3：MDN Web Docs

**操作：**
1. 选择左侧导航 → 生成 `nav.sidebar a`
2. 选择文章内容 → 生成 `article#content`

### 场景 4：React 官方文档

**操作：**
1. 选择侧边栏 → 生成 `.sidebar a`
2. 选择主内容 → 生成 `article`

## 常见问题

### Q: 如果选错了怎么办？

**A:** 有两种方法：
1. 按 ESC 键取消，然后重新选择
2. 直接再次点击"选择区域"按钮，新的选择会覆盖旧的

### Q: 提示框显示的链接数量为 0？

**A:** 可能的原因：
1. 选择的区域内没有链接 - 尝试选择父元素
2. 选择器生成不准确 - 按 ESC 取消，重新选择
3. 链接是动态加载的 - 等待页面完全加载后再选择

### Q: 可以手动修改选择器吗？

**A:** 当前版本不支持手动编辑，但可以：
1. 重新选择来更新选择器
2. 或者在代码中修改 `config.customLinkSelector` 和 `config.customContentSelector`

### Q: 选择器会保存吗？

**A:** 选择器只在当前会话中有效，刷新页面后需要重新选择。未来版本可能会添加保存功能。

### Q: 为什么有些元素无法选择？

**A:** 可能的原因：
1. 元素被其他元素覆盖（使用开发者工具检查）
2. 元素在 iframe 中（暂不支持）
3. 元素是控制面板的一部分（会自动忽略）

### Q: 可以在移动端使用吗？

**A:** 理论上可以，但：
1. 移动端的触摸事件可能不如鼠标精确
2. 小屏幕上操作可能比较困难
3. 建议在桌面端使用

## 技术细节

### 选择器优先级算法

```javascript
// 1. ID 选择器
if (element.id) return `#${element.id}`;

// 2. 类选择器
if (element.className) return `.${classes.join('.')}`;

// 3. 标签+类选择器
return `${tagName}.${firstClass}`;

// 4. 属性选择器
return `[role="${role}"]`;

// 5. 路径选择器
return `parent > child:nth-child(n)`;
```

### 事件处理

- `mousemove` - 高亮悬停的元素
- `click` - 确认选择
- `keydown (ESC)` - 取消选择

### 状态管理

```javascript
elementPickerState = {
    active: false,          // 是否处于选择模式
    mode: 'link|content',   // 选择模式
    overlay: null,          // 遮罩层元素
    tooltip: null,          // 提示框元素
    highlightedElement: null, // 当前高亮元素
    originalOutline: null   // 原始边框样式
}
```

## 未来改进

- [ ] 保存选择器配置到本地存储
- [ ] 支持选择器手动编辑
- [ ] 支持多个链接区域
- [ ] 支持 iframe 内元素选择
- [ ] 添加选择历史记录
- [ ] 支持正则表达式过滤链接
- [ ] 添加选择器测试功能

## 反馈

如果遇到问题或有改进建议，欢迎提 Issue！

---

**提示：** 打开 `demo.html` 文件可以看到交互式演示页面！
